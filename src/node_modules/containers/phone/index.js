import React, {Component} from "react";
import { connect } from "react-redux";
import { Link } from "react-router-dom";
import * as R from 'ramda'

import {fetchPhoneById, addToBasket} from 'actions'
import {getPhoneById} from 'selectors'
import BasketCart from 'components/basketCart'


class Phone extends Component {
    componentDidMount () {
        this.props.fetchPhoneById(this.props.match.params.id)
    }

    renderFields() {
        const {phone} = this.props

        const columnFields = R.compose(
            R.toPairs,
            R.pick([
                'cpu',
                'camera',
                'size',
                'memory',
                'weight',
                'battery'
            ])
        )(phone)

        return (
            columnFields.map(([key, value]) => (
                <div className="column" key={key}>
                    <div className="ab-details-title">
                        <p>{key}:</p>
                    </div>
                    <div className="ab-details-info info">
                        {value}
                    </div>
                </div>
            ))
        )
    }

    renderContent() {
        const {phone} = this.props
        return (
            <div className="thumbnail">
                <div className="container card p-4 bg-white">
                    <div className="row">
                        <div className="col-md-5">
                            <img
                            src={phone.image}
                            alt={phone.name}>
                            </img>
                        </div>
                        <div className="col-md-6">
                            {this.renderFields()}
                        </div>
                    </div>
                    <div className="caption-full">
                        <div className="d-flex justify-content-between">
                            <h4>{phone.name}</h4>
                            <h4 className="">${phone.price}</h4>
                        </div>
                        <p>{phone.description}</p>
                    </div>
                </div>
            </div>
        )
    }

    renderSidebar() {
        const {phone, addToBasket} = this.props
        return (
            <div className="card p-3 bg-white">
                <p className="lead">Quick shop</p>
                <BasketCart />
                <div className="form-group">
                    <h2>{phone.name}</h2>
                    <h2>${phone.price}</h2>
                </div>
               
                <button type='button' 
                        className="btn btn-success btn-block"
                        onClick={() => addToBasket(phone.id)}
                    > 
                        Add to cart
                    </button>
                    <Link to='/' className='btn btn-outline-secondary btn-block'>Back to store</Link>
            </div>
        )
    }


    render () {
        const {phone} = this.props
        return (
            <div className="view-container">
               <div className="container">
                   <div className="row">
                       <div className="col-md-9">
                           {phone && this.renderContent()}
                       </div>
                       <div className="col-md-3">
                           {phone && this.renderSidebar()}
                       </div>
                   </div>
               </div>
    </div>
        )
    }
}

const mapDispatchToProps = {
    fetchPhoneById,
    addToBasket
}

const mapStateToProps = state => {
    return {
        phone: getPhoneById(state, state.phonePage.id)
    }
}

export default connect(mapStateToProps, mapDispatchToProps)(Phone)